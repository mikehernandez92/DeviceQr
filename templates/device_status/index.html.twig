{% extends 'base.html.twig' %}

{% block title %}Device Status{% endblock %}
{% block stylesheets %}
    {{ encore_entry_link_tags('app') }}
    <link rel="stylesheet" type="text/css" href="{{asset('build/css/loader.css')}}">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css">

    {% endblock %}
{% block body %}

<div class="container">
    <div class="row justify-content-center mt-4">
        <div class="col-3 text-center">
            <img class="responsive" src="https://www.stardust-testing.com/wp-content/themes/stardust/img/stardust.svg">  
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-12 ">
            <table id="tableDevices" class="table table-striped table-bordered" style="width: 100%">
                <thead>
                    <tr>
                        <th>Device Id</th>
                        <th>Device name</th>
                        <th>Status</th>
                        <th>Tester</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Bt123</td>
                        <td id="device-1">Iphone 7</td>
                        <td id="status-1" data-val="1">
                            Available
                        </td>
                        <td>
                            <div class="col-md-12">
                                <div class="form-group">
                                <select class="form-control" id="tester-1" >
                                    <option value="noTester">No tester</option>
                                    <option value="Miguel Hernandez">Miguel Hernandez</option>
                                    <option value="Jeremy Breau">Jeremy Breau</option>
                                    <option value="Patricia Rivereau">Patricia Rivereau</option>
                                </select>
                                </div>
                            </div>
                        </td>
                        <td>
                            <button id="1" type="button" class="btn btn-primary changeStatus" onclick="sendRequest(this.id)">change status</button>
                        </td>
                    </tr>
                    <tr>
                        <td>BT3251</td>
                        <td id="device-2">Galaxy S10</td>
                        <td id="status-2" data-val="-1">
                            Taken
                        </td>
                        <td>
                            <div class="col-md-12">
                                <div class="form-group">
                                <select class="form-control" id="tester-2">
                                    <option value="noTester">No tester</option>
                                    <option value="Miguel Hernandez" selected>Miguel Hernandez</option>
                                    <option value="Jeremy Breau">Jeremy Breau</option>
                                    <option value="Patricia Rivereau">Patricia Rivereau</option>
                                </select>
                                </div>
                            </div>
                        </td>
                        <td>
                            <button id="2" type="button" class="btn btn-primary changeStatus" onclick="sendRequest(this.id)">change status</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        </div>

        <div class="row justify-content-center mt-4">
            <div class="col-3 text-center">
                <div id="loader"></div>  
            </div>
        </div>
</div>

{% endblock %}

{% block js %}
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
<script>

$(document).ready(function () {
    $("#loader").hide().addClass("loader");
    $('#tableDevices').DataTable();

});
function validatesTester(id){
     var testerElement= "#tester-"+id;
     if($(testerElement).val() === "noTester"){
            var notification =new Noty({
                        type: 'error',
                        layout: 'topRight',
                        text: 'Select a tester before update! '
                    });
            notification.show();
            notification.setTimeout(4500);
            return false;
        }else{
            return true;
        }
}
function sendRequest(id){
    
    var validate = validatesTester(id);

    if(validate){
        $(".changeStatus").attr("disabled",true);
        $("#loader").fadeIn("slow");
        setTimeout(function(){
            
            $("#loader").fadeOut("slow");
            changeStatus(id);
            $(".changeStatus").attr("disabled",false);
        },2000);
    }
    
}
function changeStatus(id){

        var deviceId= "#device-"+id;
        var deviceStatus="#status-"+id;
       var testerElement= "#tester-"+id;
        
            var status= $(deviceStatus).attr("data-val");

            status= status * (-1);
            if(status == 1){
                $(deviceStatus).attr("data-val",status);
                $(testerElement).val("noTester");
                $(deviceStatus).text("Available");
                
            }else{
                $(deviceStatus).attr("data-val",status);
               
                $(deviceStatus).text("Taken");
            }
            var notification =new Noty({
                        type: 'success',
                        layout: 'topRight',
                        text: 'Device '+$(deviceId).text()+' has been updated :)'
                    });
            notification.show();
            notification.setTimeout(4500);
        }
        
</script>
{% endblock %}

